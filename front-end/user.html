<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./user.css" />
    <title>CIAAQ</title>
</head>

<body>
    <div class="container" id="user">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <button class="btn btn-default flex-grow-1" id="home" name="HOME">HOME</button>
            
            <button class="btn btn-default flex-grow-1" id="askQ" name="Ask question">ASK QUESTION</button>
            
            <button class="btn btn-default flex-grow-1" id="myQ" name="My questions">MY QUESTIONS</button>
        </nav>

        <!-- <tr v-for="item in rowData">
            <th scope="row">{{ item.mail }}</th>
            <td>{{ item.date }}</td>
            <td>{{ item.adress }}</td>
            <td>{{ item.company }}</td>
            <td>{{ item.fliers }}</td>
        </tr> -->

        <tr class="table table-striped table hover" v-for="question in questions" v-bind:key="questions.category">
            <th scope="row">{{ questions.category }}</th>
            <td>{{ questions.title }}</td>
            <td>{{ questions.question }}</td>
            <td>{{ questions.user }}</td>
            <td>{{ questions.timeofquestion }}</td>
            <td type="button" class="btn btn-primary float-center" data-toggle="modal" data-target="#editAnswerModal">
                Edit
            </td>
        </tr>

        <!--   LÖS HUR VI SKA DYNAMISK FYLLA ALLA FRÅGOR SOM EN TABLE UTFIRÅN OLIKA Category-->
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Category{{}}</th>
                    <th scope="col">Title</th>
                    <th scope="col">Question</th>
                    <th scope="col">User</th>
                    <th scope="col">Timestamp</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">1</th>
                    <td>{{question.category}}</td>
                    <!-- HÄR MÅSTE VI DYNAMISK MED VUE OCH AJAX FYLLA VÅRAN TABLE MED DEM GREJERN VI VILL HA-->
                    <td>{{question.title}}</td> <!-- TEX {QUESTUIONS.QUESTION}-->
                    <td>{{question.question}}</td>
                    <td>{{question.timeofquestion}}</td>
                    <td>{{question.userQuestion}}</td>
                    <td type="button" class="btn btn-primary float-center" data-toggle="modal"
                        data-target="#editAnswerModal">Edit
                    </td>
                </tr>
                <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                    <td>@mdokalle</td>
                    <td>@mdokalle</td>
                    <td type="button" class="btn btn-primary float-center" data-toggle="modal"
                        data-target="#editAnswerModal">Edit
                    </td>
                </tr>
                <tr>
                    <th scope="row">3</th>
                    <td colspan="2">Larry the Bird</td>
                    <td>@twitter</td>
                    <td>@mdo</td>
                    <td>@mdo</td>
                    <td id="buttonEditTable" type="button" class="btn btn-danger float-center" data-toggle="modal"
                        data-target="#Härskavi länka till edit question">Edit
                    </td>
                </tr>
            </tbody>
        </table>





        <!-- HÄR ÄR MODAL FÖR ATT EDITA OCH POSTA SVAR-->
        <!-- Här är för USER och contributers att edit questions -->
        <div class="modal fade" id="editQuestionModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit a question</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                        <form id="formEditQ">
                            <div class="form-group">
                                <label for="Category">Category</label>
                                <select class="form-control" name="editCategory" id="editCategory">
                                    <option>Sport</option>
                                    <option>Homes&Households</option>
                                    <option>Movies&Series</option>
                                    <option>Relationsship</option>
                                    <option>Movies&Series</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="Title">Title</label>
                                <input type="text" class="form-control" name="editTitle" id="editTitle">
                            </div>
                            <div class="form-group">
                                <label for="edit_Qmessage">Question message</label>
                                <input type="text" class="form-control" name="edit_Qmessage" id="edit_Qmessage">
                            </div>
                            <div class="form-group">
                                <label for="edit_QmessageId">Message Id</label>
                                <input type="text" class="form-control" name="edit_QmessageId" id="edit_QmessageId"
                                    readonly>
                            </div>
                            <div class="form-group">
                                <label for="questionUser">User: </label>
                                <input type="text" class="form-control" name="questionUser" id="questionUser" readonly>
                            </div>
                            <div class="modal-footer">
                                <!-- PÅ EXEMPEL KÖR DEM FORM-GROUP MEN DENNA ÄR FRÅN BOOTSTRAP-->
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <input type="button" class="btn btn-primary" value="Delete answer"
                                    v-on:click="deleteQuestion">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- HÄR ÄR MODAL FÖR ATT STÄLLA FRÅGOR SOM USER-->

        <div class="modal fade" id="askQuestionModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Ask a question</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formAdd">
                            <div class="form-group">
                                <label for="Category">Category</label>
                                <select class="form-control" name="addCategory" id="addCategory">
                                    <option>Sport</option>
                                    <option>Homes&Households</option>
                                    <option>Movies&Series</option>
                                    <option>Relationsship</option>
                                    <option>Movies&Series</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="Title">Title</label>
                                <input type="text" class="form-control" name="addTitle" id="addTitle">
                            </div>
                            <div class="form-group">
                                <label for="add_Qmessage">Question message</label>
                                <input type="text" class="form-control" name="add_Qmessage" id="add_Qmessage">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <input type="button" class="btn btn-primary" value="Ask question"
                                    v-on:click="askQuestion">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>

        const userVue = new Vue({
            el: "#user",
            data: {
                users: [],
                category: [],
                title: [],
                questions: [],
                answers: [],
                rowData: []
            },
            methods:
            {

                ShowQuestionInUpdateForm(id) { //Vet inte om det är rätt detta, Detta är mest för att fylla på med grejer.
                    $.ajax({
                        url: '/questions' + id,
                        type: 'GET',
                        success: (questions) => {
                            document.getElementById("UpdateCategory").selectedIndex = questions.category_id - 1;
                            $('#editCategory').val(questions.Category);
                            $('#editTitle').val(questions.Title);
                            $('#edit_Qmessage').val(questions.Answer);
                            $('#edit_QmessageId').val(questions.id)
                            //Måste vi ta emot alla saker som finns i vår table questions?
                        }
                    });
                    $('#editQuestionModal').modal('show');
                },
                // getUserQuestion() {
                //     $.ajax({
                //         url: '/userquestions',
                //         type: 'GET',
                //         success: (questions) => {
                //             slef.question = questions;
                //             document.getElementById("UpdateCategory").selectedIndex = questions.category_id - 1;
                //             $('#editCategory').val(questions.Category);
                //             $('#editTitle').val(questions.Title);
                //             $('#edit_Qmessage').val(questions.Answer);
                //             $('#edit_QmessageId').val(questions.id)
                //             //Måste vi ta emot alla saker som finns i vår table questions?
                //         }
                //     });
                //     $('#editQuestionModal').modal('show');


                // },

                editUserQuestion() {
                    var question = {
                        category: $('#editQuestionModal #editCategory').val(), //readonlyigentligen, man ska inte ändra categori? eller?
                        title: $('#editQuestionModall #editTitle').val(),
                        qMessage: $('#editQuestionModal #edit_Qmessage').val(),
                        qMessageId: $('#editQuestionModal #edit_QmessageId').val(),
                        user: $('#editQuestionModal #questionUser').val(),
                    }
                    $.ajax({
                        url: 'answer',
                        type: 'PUT',
                        data: question,
                        success: () => {
                            var self = this;
                            $getJSON("questions", function (jsondata) {
                                self.questions = jsondata;
                            });
                            $('editQuestionModal').modal('hide');
                        },
                        error: (error) => {
                            console.log(error);
                        }
                    });
                },

                askQuestion() {
                    const question = {
                        category_id: $('#addCategory').prop('selectedIndex') + 1,
                        title: $('#addTitle').val(),
                        qMessage: $('#add_Qmessage').val()
                    }
                    $.ajax({
                        url: '/question',
                        type: 'POST',
                        data: question,
                        success: () => {
                            getQuestions();
                            $('#askQuestionModal').modal('hide');
                            clearAddForm();// DENNA ÄR FEL. DET MÅSTE STÄMMA MED ALLA MODAL. DET GÄLLER ALL KOD.
                        }
                    });
                },

                deleteQuestion(id) {
                    var question = {
                        id: $('#editQuestionModal #updateId').val()
                    }
                    $.ajax({
                        url: '/deleteQuestion' + question.Id,
                        type: 'DELETE',
                        success: () => {
                            var self = this;
                            $.getJSON("questions", function (jsondata) {
                                self.questions = jsondata;
                            });
                        }
                    });
                },

                mounted() {
                    var self = this;
                    $.getJSON("/userquestions", function (jsondata) {
                        self.questions = jsondata;
                    });
                }
            }
        });



    </script>
</body>

</html>